#### 演进

![image-20221023211641472](.\img\image-20221023211641472.png)

##### 多道程序设计

- 早期批处理系统只能一次处理一个任务，多道程序设计使得批处理系统可以一次处理多个任务。
- 多道程序在计算机的管理程序之下相互穿插运行，对多道程序的管理是现代操作系统的重要功能。

![image-20221023212114957](.\img\image-20221023212114957.png)

#### 进程&线程

##### 进程的定义

- 在内存中运行的可执行程序的实例我理解为进程，他是操作系统资源分配和调度的基本单位。
- 当运行一个程序，操作系统会在内存中分配程序需要的资源，进程就是计算机资源分配的基本单位。
- 一个进程拥有的资源有自己的堆、栈、虚存空间（页表）、文件描述符等。
- 从编程的结构看进程，他可以是一个结构体，这个结构体包含，进程编号(pid)，进程的身份标志，进程的状态，新建状态，就绪状态 ，运行状态，阻塞状态，销毁状态，执行优先级，上下文（保存本次执行状态，以便下次继续执行，这个过程就是一个上下文），内存地址。

##### 进程的五状态

<img src=".\img\image-20221023213629188.png" alt="image-20221023213629188" style="zoom:50%;" />

- 创建，进程拥有PCB(进程控制块，程序中的一个结构体)但其他资源尚未就绪的状态。操作系统提供fork函数接口创建进行。
- 阻塞，进程因某种原因，如：其他设备未就绪而无法继续执行。从而放弃CPU的状态。
- 就绪，其他资源都准备好，只差CPU资源的状态。
- 运行，进程获得CPU资源，正在执行。在单核CPU中，只能有一个进程处于运行状态。
- 终止，进程结束由操作系统清理或者归还PCB的状态。

##### 请简述同步和异步的区别？

- 同步和异步强调的是**消息通信机制**。
- 阻塞和非阻塞强调的是**程序在等待调用结果时的状态**。

##### 线程

- 进程被调度到cpu的一个执行流叫线程。他是操作系统运行调度的最小单位，包含在进程中，是进程中实际运行工作的单位，cpu分配时间的单位。
- 多个线程可以共享进程的资源(堆和方法区)，程序计数器和栈是每个线程私有的。程序计数器是一块内存区域，用来记录线程当前要执行的指令地址。栈是用来记录每个线程自己的局部变量的。堆中存放的是当前程序创建的所有对象，方法区存放的是常量和静态变量等信息。



##### 进程和线程的区别

- 进程是资源的拥有者(占用内存)，线程是资源的调度者(占用cpu资源)。进程包含了线程。一般情况下，进程的操作者是操作系统，线程的操作者是程序员。
- 多个进程间不能共享资源，同个进程下的多个线程共享进程资源(比如内存)。
  - 进程所维护的是程序所包含的资源（静态资源），比如：地址空间、打开的文件句柄、文件系统状态，信号处理handler
  - 线程所维护的是程序运行相关的资源（动态资源），如：运行栈、调度相关的控制信息、待处理的信号集...
- 进程的上下文切换，进程创建销毁，开销比线程大。
- 进程更稳定安全
  - 进程有独立的内存空间，一个进程崩溃后，在保护模式下对其他进程不会有影响，而线程只是一个进程中的不同的执行路径，有独立的地址空间，一个进程死掉等于该进程下所有的线程死掉。
  - 所以多进程的程序要比多线程的的程序稳健，但在多进程切换时，耗费资源大，性能较差。



##### 进程/线程之间的亲缘性

- 亲缘性的意思是进程/线程只在某个CPU上运行（多核系统）
- 使用CPU亲缘性的好处：防止进程/线程在CPU的多核间频繁切换，从而避免因切换带来的CPU的L1/L2 cache失效，cache失效会降低程序的性能。



##### 解决一个问题的时候，线程数量是越多越好么？

- 不是，线程切换消耗cpu资源。极端情况下，线程切换消耗的时间还比cpu实际执行所消耗的实际更多。



##### 一个核心没做超线程处理的cpu执行多线程程序有意义么？

- 有的，一个线程执行时并不是一直需要占用cpu计算，有时一些io操作需要等待，等待过程中用不到cpu。



##### 多线程需要注意的

- 内存可见性。java validate关键字，go语法约定的happens-before
- 有序性。为了提高cpu利用率，指令会随机执行，单线程情况下可以保证乱序的指令最终执行结果一致。多线程加锁（内存屏障 ）
- 原子性。加锁，cas解决方案，cas的aba问题(加版本号)，cas本身的原子性保证。



> [进程 线程 协程 各自的概念](https://juejin.cn/post/6950952506176471071?share_token=309a39ea-624a-4066-8b90-2b5818170a95)
>
> [马士兵进程&线程](https://www.bilibili.com/video/BV16541157ZC?p=2&spm_id_from=pageDriver&vd_source=5eb4684f9240445590fb913bac72198d)

##### 请简述什么是操作系统的内核态和用户态

- 操作系统负责对计算机的各种资源进行管理，比如cpu资源、文件资源、IO设备资源等。

- 为了避免普通开发者对计算机资源的错误使用造成不可逆转的损失，操作系统状态分为内核态和用户态，资源调度程序运行在内核态里，用户编写的程序在非必要情况下运行在用户态。

- **内核态**

  内核空间：存放的是内核代码和数据

  进程执行操作系统内核的代码

- **用户态**

  用户空间：存放的是用户程序的代码和数据

  进程在执行用户自己的代码（非系统调用之类的函数）

  CPU只允许访问优先的内存，不允许访问外设

  ![image-20221023233059888](.\img\image-20221023233059888.png)

- 内核态/用户态 **切换**

  系统调用、异常中断、外围设备中断
