#### 计算机网络概述

**计算机网络：一个集合体，通过通讯线路进行连接互相传输数据的，可以在不同的地理位置，独立工作的主机。**

- 1970年以前，大多数计算机是独立运行的。“球鞋网络”，在公司或研究室内部使用，方便信息交换，共享物理资源，共享存储空间。
- 近距离构成的小型网络叫局域网，简称LAN；其中最出名的LAN技术是“以太网”，开发于1970年，今日仍被广泛使用。
  - 以太网最简单的形式是：一条以太网线连接数台计算机，当一台计算机要传输数据给另一台计算机时，它以电信号形式，将数据传入电缆，因为电缆是共享的，连在同一个网络里的其他计算机也看得到数据，但不知道数据是给它们的，还是给其他计算机的，为了解决这个问题，以太网需要每台计算机有唯一的媒体访问控制地址，简称MAC地址，mac地址是网卡的物理地址，也叫硬件地址或链路地址，由网络设备制造商生产时写在硬件内部，是唯一的。这个唯一地址放在头部，作为数据的前缀发送到网络中，所以计算机只需要监听以太网电缆，看到自己的MAC地址才处理数据，现在每台计算机都自带唯一的MAC地址，用于以太网和无线网路。
- 多台电脑共享一个传输介质，这方法叫“载波侦听多路访问”，简称“CSMA”。载体指运输数据的共享媒介，以太网的“载体”是铜线，WIFI的载体是传播无线电波的空气，很多计算机同时侦听载体，所以叫“侦听”和“多路访问”。而载体传输数据的速度叫“带宽”。
- 不幸的是，使用共享载体有个很大的弊端，当网络流量较小时，计算机可以等待载体清空，然后传输数据，但随着网络流量的上升，两台计算机想同时写入数据的概率也会上升。这叫“冲突”，数据全乱套了。就像两个人同时在电话讲话。
- 幸运的是，计算机能够通过监听电线中的信号，检测这些冲突，最明显的解决办法是停止传输，等待网络空闲，重新传输。问题是其他计算机也打算这样做，等待传输的间隙别的计算机可能又会传输，导致越来越多的冲突。
- 以太网有个超有效的解决方式，当计算机检测到冲突就会在重传之前随机等待小段时间。这很有用，但不能完全解决问题，所以当重复上传前再次检测到冲突会等待多1秒+随机时间，再次等待2秒+随机时间。4秒，6秒...知道成功传输。因为计算机退避，冲突次数降低了，数据再次开始流动起来。这种指数级增长等待时间的方法叫：指数退避。以太网和wifi都用，很多其他传输协议也用。
- 即使有这种指数退避的技术，想用一根网线连接整个大学的计算机还是不可能的，为了减少冲突+提高效率，我们需要减少统一载体设备的数量，载体和其中的设备总称“冲突域“，为了减少冲突，我们可以用交换机把一个大的冲突与拆分为两个小的冲突域，交换机位于两个小的网络间，必要时在两个网络间传数据，交换机会记录一个列表，写着哪个MAC地址在哪边网络，同一边的计算机互相通信不需要经过交换机，不同边(不同冲突域)的计算机通信会通过交换机，此时，两边的网络都会短暂占用。大的计算机网络也是这样构成的，包括最大的网络互联网。大型网络的特点就是，从一个地方到另一个地方有多条路线，这就带出了另一个问题，路由。
- 连接两台相隔遥远的计算机，最简单的办法是分配一条专用的通信线路，早期的电话也是这样运作的。传输数据的另一个方法是”报文交换“，报文交换就像邮政系统一样，消息会经过好几个站点，每个站点都有表格知道下一站发哪里，记录到各个目的地，信件该怎么传，报文交换的好处是，可以用不同路由，使通信更可靠，更能容错。
- 消息沿着路由跳转的次数叫”跳数”，记录“跳数”很有用，因为可以分辨出路由问题，如果看到某条消息条数很高，就知道路由肯定哪里错了，这叫“跳数限制”。报文交换的缺点之一就是有时候报文比较大，会堵塞网络，因为要把整个报文从一站传到下一站后才能继续其他传递报文，解决办法是将大报文分成很多个小块，叫"数据包"，就像报文交换，每个数据包都有目的地址，因此路由器知道发到哪里，报文具体格式由“互联网协议”定义，简称IP，这个标准创建于1970年代，每台联网的计算机都需要一个IP地址。
- 既然每个以太网设备在出厂时都有一个唯一的MAC地址了，那为什么还需要为每台主机再分配一个IP地址呢？或者说为什么每台主机都分配唯一的IP地址了，为什么还要在网络设备（如网卡，集线器，路由器等）生产时内嵌一个唯一的MAC地址呢？主要原因有以下几点：（1）IP地址的分配是根据网络的拓朴结构，而不是根据谁制造了网络设置。若将高效的路由选择方案建立在设备制造商的基础上而不是网络所处的拓朴位置基础上，这种方案是不可行的。（2）当存在一个附加层的地址寻址时，设备更易于移动和维修。例如，如果一个以太网卡坏了，可以被更换，而无须取得一个新的IP地址。如果一个IP主机从一个网络移到另一个网络，可以给它一个新的IP地址，而无须换一个新的网卡。（3）无论是局域网，还是广域网中的计算机之间的通信，最终都表现为将数据包从某种形式的链路上的初始节点出发，从一个节点传递到另一个节点，最终传送到目的节点。数据包在这些节点之间的移动都是由ARP（Address Resolution Protocol：地址解析协议）负责将IP地址映射到MAC地址上来完成的。
- 下面我们来通过一个例子看看IP地址和MAC地址是怎样结合来传送数据包的。假设网络上要将一个数据包（名为PAC）由北京的一台主机（名称为A，IP地址为IP_A，MAC地址为MAC_A）发送到华盛顿的一台主机（名称为B，IP地址为IP_B，MAC地址为MAC_B）。这两台主机之间不可能是直接连接起来的，因而数据包在传递时必然要经过许多中间节点（如路由器，服务器等等），我们假定在传输过程中要经过C1、C2、C3（其MAC地址分别为M1，M2，M3）三个节点。A在将PAC发出之前，先发送一个ARP请求，找到其要到达IP_B所必须经历的第一个中间节点C1的MAC地址M1，然后在其数据包中封装（Encapsulation）这些地址：IP_A、IP_B，MAC_A和M1。当PAC传到C1后，再由ARP根据其目的IP地址IP_B，找到其要经历的第二个中间节点C2的MAC地址M2，然后再将带有M2的数据包传送到C2。如此类推，直到最后找到带有IP地址为IP_B的B主机的地址MAC_B，最终传送给主机B。在传输过程中，IP_A、IP_B和MAC_A不变，而中间节点的MAC地址通过ARP在不断改变（M1，M2，M3），直至目的地址MAC_B。
- 综合上面所述，我们可以归纳出IP地址和MAC地址相同点是它们都唯一，不同的特点主要有：
  - 对于网络上的某一设备，如一台计算机或一台路由器，其IP地址可变（但必须唯一），而MAC地址不可变。我们可以根据需要给一台主机指定任意的IP地址，如我们可以给局域网上的某台计算机分配IP地址为192.168.0.112 ，也可以将它改成192.168.0.200。而任一网络设备（如网卡，路由器）一旦生产出来以后，其MAC地址永远唯一且不能由用户改变。
  - 长度不同。IP地址为32位，MAC地址为48位。
  - 分配依据不同。IP地址的分配是基于网络拓朴，MAC地址的分配是基于制造商。
  - 寻址协议层不同。IP地址应用于OSI第三层，即网络层，而MAC地址应用在OSI第二层，即数据链路层。 <b>数据链路层协议可以使数据从一个节点传递到相同链路的另一个节点上（通过MAC地址），而网络层协议使数据可以从一个网络传递到另一个网络上</b>（ARP根据目的IP地址，找到中间节点的MAC地址，通过中间节点传送，从而最终到达目的网络）。
- 数百万台计算机在网络上不断交换数据，瓶颈的出现和消失都是毫秒级的，路由器会平衡与其他路由器之间的负载，以确保传输可以快速可靠，这叫“阻塞控制”，有时，同一个报文的多个数据包会经过不同线路，到达顺序会不一样，这对一些软件是个问题。幸运的是，在IP之上还有其他协议，比如TCP/IP协议，可以解决乱序问题。将数据拆分成多个小数据包，然后通过灵活的路由传递，非常高效且可容错，如今互联网就是怎么运行的，这叫“分组交换”，有个好处是，去中心化，没有中心权威机构，没有单点失败问题，实时上，因为冷战期间有核攻击威胁，所以创造了分组交换，如今，全球的路由器协调工作，找出最高效的线路，用各种标准协议运输数据，比如“因特网控制消息协议”（ICMP）和“边界网关协议”（BGP）
- 看一个视频首先要连到局域网LAN，你家WIFI路由器连着的所有设备组成了局域网。局域网再连到广域网WAN，WAN的路由器一般属于你的“互联网服务提供商”，简称ISP，广域网先连到一个区域性路由器，这些路由器可能覆盖一个街区。然后再连到一个更大的WAN，可能覆盖整个城市，可能再跳几次，但最终会到达互联网的主干。互联网主干由一群超大型、宽带超高路由器组成。如果你在用window，MAC OS或Linux系统，可以用traceroute来看跳几次。
- 互联网是一个巨型分布式网络，会把数据拆成一个个数据包来传输，数据包想在互联网上传输要符合“互联网协议”的标准，简称IP，因为IP是个非常底层的协议，数据包的头部（或者前面）只有目标地址，头部存“关于数据的数据”也叫“元数据”，这意味着当数据包达到对方电脑，对方不知道把包交给哪个程序，因此在IP协议之上，开发更高级的协议。这些协议里，最简单最常见的叫“用户数据报协议”，简称UDP，UDP也有头部，这个头部位于数据前面，头部包含有用的信息，信息之一是端口号，每个想访问网络的程序，都需要向系统申请一个端口号。当一个数据包达到时，接收方的操作系统会读UDP头部，读里面的端口号，并按照端口号找到接收的程序。
  - <img src=".\img\image-20210105010322874.png" alt="image-20210105010322874" style="zoom:50%;" />
- IP负责把数据包送到正确的计算机，UDP负责把数据包送到正确的程序。
- UDP头部里还有“校验和”，用于检查数据是否正确。假设UDP数据包里原始数据为89，111，33..，在发送数据包前，电脑会把所有数据加在一起，算出”校验和“。UDP中校验和以16位形式存储，如果算出的和超过16位能表示的最大值，高位数会被丢掉，保留低位。当接收方电脑收到这个数据包，他会重复这个步骤，把所有数据加在一起，如果结果和头部中的校验和一致，代表一切正常。如果不一致代表数据坏掉了，也许传输时碰到了功率波动，或者电缆故障。不幸的是，UDP不提供数据修复或数据重发的机制，接收方知道数据损坏后，一般只是丢掉。而且，UDP无法得知数据包是否到达。发送方发送之后，无法知道数据包是否达到目的地。有些程序不在意，比如直播，最多掉帧。因为UDP又简单又快。
- 如果所有数据必须到达，就用“传输控制协议”，简称"TCP"。TCP和UDP一样，头部也存在数据前面，因此有人叫这个组合TCP/IP。就像UDP，TCP头部也有“端口号”和“校验和”，但TCP有更高级的功能，主要有:
  - TCP数据包有序号，序号可以使接收方可以把数据包排成正确的顺序，即使达到时间不同。
  - TCP要求接收方的电脑收到数据包，并且“校验和”检查无误后（数据没有损坏）给发送方发一个确认码，代表收到了。确认码简称“ACK”得知上一个数据包成功达到后，发送方会发送下一个数据包。假设这次发出去没收到确认码，那么肯定哪里错了，如果过了一段时间还没有收到确认码，发送方会再发一次，注意，数据包可能到了，只是确认码延误了，但这不碍事，因为发送方有序列号，如果收到重复的数据包就删掉，还有TCP不是一次只能发一个数据包，可以同时发送多个数据包，收多个确认码，这大大增加了效率，不用浪费时间等确认码。确认码的成功率和来回时间，可以推算网络的拥堵情况。TCP用这个信息，调整同时发包数量，解决拥堵问题。
  - <img src=".\img\image-20210105012301684.png" alt="image-20210105012301684" style="zoom:50%;" />
- 简单说，TCP可以解决乱序和丢失数据包，丢了就重发，还可以根据拥堵情况自动调整传输率。
- TCP最大的缺点是，那些“确认码”把数据包数量翻了一倍，但没有传输更多信息，有时候这种代价是不值得的，特别是对时间要求很高的程序，比如在线射击游戏。
- 当计算机访问一个网站时，需要两个东西：1.IP地址 2.端口号，但IP地址特别难记，所以互联网有个特殊服务，负责把域名和IP地址一一对应，就像互联网的电话簿，它叫”域名系统“，简称"DNS"。在浏览器里输入www.baidu.com，浏览器回去问DNS服务器，它的IP地址是多少，一般DNS服务器是互联网提供商提供。DNS会查表，如果域名存在，就返回对应IP地址。如今有上千万个注册域名，所以为了更好管理，DNS不是存成一个超长超产的列表，而是存成树状结构。顶级域名（简称TLD）在最顶部，比如.com和.gov，下层是二级域名，比如.com下面有goole.com，再下层叫子域名，比如images.goole.com。这个树超级大。因此这些数据散布在很多DNS服务器上，不同服务器负责树的不同部分。
- 线路里的电信号，和无线网络里的无线信号，这些叫”物理层“，而”数据链路层“负责操控”物理层“，数据链路层有：媒体访问控制地址MAC，碰撞检测，指数退避，以及其他一些底层协议，再上一层是”网络层“，负责各种报文交换和路由。UDP和TCP这些协议在”传输层“，负责计算机之间进行点到点传输，而且会检测错误和修复错误。”会话层“会使用TCP和UDP来创建连接，传递信息，然后关闭连接，这一套叫”会话“，查询DNS或查看网页时，就会发生着一套流程。
- <img src=".\img\image-20210105014254549.png" alt="image-20210105014254549" style="zoom:50%;" />
- 在此之上还有表示层，应用程序层。
- 万维网在互联网上运行。互联网是传递数据的管道，各种程序都会用，其中传输最多数据的程序时万维网，分布在全球数百万个服务器上，可以用浏览器来访问万维网。
- 万维网最基本的单位是单个页面。页面有内容，内容里也可以连接，点击连接跳转到别的页面，这些连接叫超链接。他们形成巨大的互联网络，这就是万维网。为了使网页能相互连接，每个网页都需要一个唯一的地址，这个地址叫”统一资源定位器“，简称URL。
- 当你访问一个网页时，计算机首先会做DNS查找，比如DNS查找输入的是一个域名，DNS服务器会输出对应的IP地址，现在有了这个IP地址，你的浏览器会打开一个TPC连接到这个IP地址，这个地址运行着网路服务器，网络服务器的标准端口号是80，这时你的计算机就连接到该服务器，下一步是向服务器请求具体页面，这里会用”超文本传输协议“（HTTP）。HTTP第一个标准，HTTP 0.9，创建于1991年。只有一个指令，”GET“。比如我们想要courses页面，我们会像服务器发送指令”GET/courses"，该指令以ASCII编码发送到服务器。服务器会返回该地址对应的网页，然后浏览器会渲染到屏幕上。在之后的版本中，HTTP添加了状态码，状态码放在请求前面。举例，状态码200代表“网页找到了，给你”。状态码400~499代表客户端出错，比如网页不存在，就是可怕的404错误。超文本的存储和发送都是以普通文本形式的，举个例子，编码可能是ASCII或UTF-16。因为如果只有纯文本，无法表明什么是链接，什么不是链接，所以有必要开发一种标记方法，即超文本标记语言（HTML），第一版的版本号是0.8，创建于1990年。
- 起初人们通过维护一个目录在万维网上搜寻资源。其中最有名的叫“Jerry和David的万维网指南”。随着网络增大，人工编辑的目录变的不便利，所以开发了搜索引擎。长得最像现代搜索引擎的最早搜索引擎，叫JumpStation，它有3个部分。
  - <img src=".\img\image-20210105113434383.png" alt="image-20210105113434383" style="zoom:50%;" />
  - 第一个是爬虫，一个跟着链接到处跑的软件。每当看到新链接，就加到增加的列表里。
  - 第二个部分是不断扩张的索引。记录访问过的网页上，出现过哪些词。
  - 最后一个部分是，查询索引的搜索算法。
- 早期搜索引擎的排名方式非常简单，取决于搜索词在页面出现的次数，有人利用这个恶意推广。谷歌成名的一个很大原因是创造了一个聪明的算法来规避这个问题，与其信任网页上的内容，搜索引擎会看其他网站，有没有链接到这个网站。这些“反向链接”数量多的网站，是有信誉的网站，代表了网站的质量。
- 网络中立性，应该平等对待所有数据包，但很多公司乐意让他们的数据优先到达。

#### 网络模型

<img src=".\img\image-20221013154825596.png" alt="image-20221013154825596" style="zoom: 33%;float:left;" />

<img src=".\img\image-20221013005525441.png" alt="image-20221013005525441" style="zoom: 33%;float:left;" />

<img src=".\img\image-20221013005924112.png" alt="image-20221013005924112" style="zoom: 33%;float:left;" />

##### TCP、UDP、IP协议分别属于什么层？

- TCP、UDP位于传输层，IP协议位于网络层。

##### 网络层详解

- OSI模型：第三层、TCP\IP模型：第二层
- 关键协议：IP协议、ICMP协议
- 网络层属于主机之间的通信，它的目的是向上提供简单灵活的、**无连接的**、尽最大努力交付的**数据包服务**，网络层不提供服务质量的承诺
- 划重点：
  - 不需要建立连接
  - 每个数据报单独路由
  - 每个数据报有完整的目标地址
  - 不提供可靠的连接
  - 到达终点可能无序
  - 由终点进行差错控制

##### 传输层

- OSI模型：第四层、TCP\IP模型：第三层
- 关键协议：TCP协议、UDP协议
- 传输层属于**主机间**不同进程的通信，传输层向上面的应用层提供通信服务，并屏蔽了下面的核心网络细节，使得面向传输层编程就像是两个主机进程之间有一条端到端的逻辑通信信道一样，当传输层采用TCP协议时，这条逻辑通信通道就是一条可靠的通信信道，而尽头下面的网络是不可靠的。

##### 应用层

- 关键协议：HTTP协议、FTP协议、SMTP协议、DNS等等
- 定义了运行在不同端系统上的应用程序进程如何互相传递报文。

##### 小结

- 网络接口层
  - 物理层：规定通讯设备**机械的、电气的、功能的和过程的**特性。传输**比特流**
  - 数据链路层：负责在**两个相邻节点间的线路上**，无差错地传送以帧为单位的数据以及流量控制信息，即**差错控制、流量控制、帧同步**。传输**帧**。服务访问点叫**mac地址**。

- 网络层：确定数据包从发送方到接收方如何**选择路由，拥塞控制，分片重组**。提供主机之间的通信。传输**包**。服务访问点叫**ip地址**。
- 传输层：提供主机间不同进程之间的通信，分组排序，流量控制（自下而上第一个可以提供无差错按顺序的**端到端**服务）。传输**段/报文**。服务访问点叫**端口号**。
- 应用层：提供不同应用之间的通信，传输数据。
  - 应用层：为端用户服务
  - 表示层：为应用层提供可选择的服务集合，应用层可以根据这些服务功能**解释数据含义**。表示层以下只关心如何可靠传输数据，表示层关心的是所传输数据的表现方式，语法，语义，具体做的如**数据编码、压缩、加密等**。
  - 会话层：支持两个表示层实体之间交互。提供**会话管理**(把两个表示层实例结合或分开)，**会话服务**(控制两个表示层数据交换，例如分段、同步)

实际上，应用层定义了进程交换的报文类型、报文的语法、字段的含义、进程如何发生数据、怎么样发送数据等等。

OSI七层模型是理论模型，现在的英特网用的是tcp/ip的四层模型(DOD)。

##### TCP和UDP的区别？

- tcp有连接有状态，面向流，可靠，消息有序，丢失重发，报头大速度慢。主要用在电子邮件，文件传输，http等。
- udp无连接无状态，面向报文，只管发什么都不保证，无序，包头小，速度快。主要用在流媒体通信，射击游戏等。

##### Tcp三次握手？

- **三次握手**的作用是：在进行通信前，确定客户端和服务端的**收、发**能力正常。确认序列号，窗口大小。

- 过程

  ![image-20221013171011138](.\img\image-20221013171011138.png)

  - 客户端想服务端发送包含SYN和seq的网络包，SYN同步位，SYN=1表示请求同步连接，随机生成一个序列号seq(ISN)。
  - 服务端回复SYN=1表示同步请求，ACK=1表示收到了客户端的同步请求。随机生成序列号y，seq=y。ack是确认号，ack=x+1，表示序号到x为止所有数据都已正确收到，希望下个报文序号从x+1开始。
  - 客户端最后依次握手回复。ack=1表示回复，序列号seq=x+1，ack=y+1表示已经收到服务端到y序号位置的数据，希望下个报文序号从y+1开始。

##### tcp如果只有两次握手？

- 比如客户端请求建立连接，服务端建立了，回应了一个数据包，该数据包客户端没有收到。客户端以为连接失败，再次重新请求建立连接，这次成功了。此时服务端认为存在两个连接，客户端一个，服务端第一次建立的连接白白等在那，浪费资源。
- 又比如客户端请求建立连接，因为网络问题，数据包并没有送到服务器，超时再次重新请求建立连接，这次成功了。此时，客户端第一次发送的包送到，服务端又建立了连接，此时服务端存在2个连接，客户端1个。两边状态不同步。

##### TCP四次挥手？

![在这里插入图片描述](.\img\83b8a9c2c1b847cfb952f045b508fde1.png)

- 第一次挥手：client需要向server发送一个FIN包，表示需要关闭连接，自己进入FIN-WAIT-1（终止等待1）状态；
- 第二次挥手：server收到FIN包，回复ACK包，表示自己进入CLOSE-WAIT（关闭等待）状态，client收到ACK后，进入FIN-WAIT-2（终止等待2）状态；
- 此时server还可以发送未发送的数据，client还可以接收数据（这就是为什么第二次挥手和第三次挥手不能合并的原因，server需要发送自己未发送的数据）；
- 第三次挥手：待server发送完数据之后，再发送一个FIN包，进入LAST-ACK（最后确认）状态；
- 第四次挥手：client收到FIN包后，回复ACK包，自身进入TIME-WAIT（超时等待）状态，经过超时时间后，关闭连接；而server收到ACK包后，立即关闭连接；

##### 请简述什么是TIME-WAIT状态

- TIME-WAIT状态是指第四次挥手后，主动方所处的状态，这个状态下，主动方尚未完全关闭TCP连接，端口不可复用。持续2MSL，MSL默认2分钟，2MSL即4分钟。

##### 为什么TIME-WAIT状态需要持续2MSL？

- 确保双方断开连接。在2MSL时间内，如果第四次挥手没有到达对方，那么对方会重新进行第三次挥手，确保连接正确释放。
- 确保当前连接所有的报文已经过期（第四次挥手是连接的最后一个报文，如果最后一个报文过期，即使网络中存在残存的报文也不会对双方造成影响）

##### tcp如何保证可靠？

- 停止等待协议，即发送一条数据，等待接收方确认(确认应答机制)。为了提高效率，可以同时发送不超过窗口滑动指定的数据，接收方tcp有个累计确认机制不需要每条数据都回复确认码，当收到多条信息时，，只需要回复发送方最后的序号+1即表示到该序号的消息全部接收到了。
- 还要校验和、序列号等

##### 什么是窗口滑动？

- 用于流量控制，窗口指明允许对方发送的数据量（我还要多少缓存可以用，别超过哈），解决发送和接收速率不匹配的问题。
- 滑动窗口的大小取决于通信双方能同时处理的数据，发送方的滑动(发送)窗口 = 发送方的拥塞窗口和乙的接收窗口(接收缓存)的最小值。
- tcp通讯双方维护对方的滑动窗口（对方最大接收数据量），报文中专门有这么一个字段告知对方我的滑动窗口大小。

##### 窗口滑动的工作原理？

- tcp是以字节流传输的，窗口指的是字节流上可以同时传输的最大数据。窗口滑动过程可以这样理解，接收方确认数据后窗口往后滑动，发送方又可以发送新的数据了，当未确认的数据占满整个窗口则发送方无法发送新数据，需要等待确认。

##### tcp如何保证消息有序?

<img src=".\img\image-20221024005304850.png" alt="image-20221024005304850" style="zoom:50%;" />

##### 网络拥塞？

- 某段时间内，对网络中的某一资源（带宽、缓存、处理机等）的需求超过了该资源所提供的可用部分，网络性能就会变坏，这种情况称为网络拥塞。

##### 拥塞避免(控制)算法？

- 为了防止过多的数据注入到网络，避免网络中的路由器或链路过载，对送方发送速率的控制算法。

##### tcp拥塞避免算法有哪些？工作原理？

- **算法**：慢开始、拥塞避免、快重传、快恢复

- ![image-20221023010901523](.\img\image-20221023010901523.png)

  发送方维护一个叫拥塞窗口的变量，和滑动窗口不一样呀，**滑动窗口是用于控制同时发送流量大小**，取发送方和接收方能同时处理的数据最小值。**拥塞窗口是发送方网络拥堵时避免发更多包造成更拥堵而维护的一个变量**。拥塞窗口决定发送方发送频率，因为一开始摸不准网络情况，会由小到大发包，假设一开始拥塞窗口值为1，一次发送一个数据包，收到ack后，成指数增长，一次发送1,2,4,6...个数据包(都收到ack)，叫逐渐增长的过程称为**慢开始**，为了避免拥塞窗口值增长过快，引入了一个阈值**ssthresh**，当拥塞窗口大于ssthresh时，避免拥塞，数据包发送增长频率改为一次发送7,8,9..个包，这个线性增长的过程叫做**拥塞避免**，随着拥塞窗口越来越大(一次发送的包越来越多)，会进入网络拥塞状态，这时就会发生超时。发送方会维护一个计时器，接收方没有在规定时间ack认定为超时，此时发送方会设置 阈值 = (当前拥塞窗口大小)/2，拥塞窗口 回复 为1，重新执行慢发送算法，直到再次进入拥塞避免...再次重设阈值。

  ![image-20221023023318591](.\img\image-20221023023318591.png)

- 有时，个别报文会在网络中丢失，但实际上网络并未发生拥塞，这将导致发送方超时重传，并误认为网络发生了拥塞，进入慢开始算法降低传输效率。

  1990年增加了两个拥塞控制算法避免这种情况，即**快重传**和**快恢复**。

  ![image-20221023011119175](.\img\image-20221023011119175.png)

  发送方一旦收到3个重复确认，就知道现在只是丢失了个别的报文段，于是不启动慢开始算法，而执行快恢复算法。快恢复看下图绿色字。

- ![image-20221023010737089](.\img\image-20221023010737089.png)

##### tcp粘包？

- tcp是面向字节流的协议，没有数据边界。

- 粘包指应用层开发者基于tcp通讯时错误的解释两个报文或者错误的拆分两个报文。粘包不是tcp协议造成的，而是应用层协议设计缺陷造成的。http通过首部Content-Length字段标识消息体大小拆分数据。

- 分离消息的两个方法：基于长度、基于特殊字符拆分。

- 基于tcp的应用层协议应自行设计消息边界，正确分离消息，避免消息粘连。

- 早期为了提高网络利用率常常堆积数据，到达一定量再发送，这就是nagle算法

  ![image-20221023162725491](.\img\image-20221023162725491.png)

  采用nagle算法后要特别注意粘包问题，因为多个业务消息可能作一个数据块发送。

##### 什么是SYN Flood攻击（洪水攻击）？

- ![image-20221023183103659](.\img\image-20221023183103659.png)

##### 既然TCP已有心跳机制，为什么我们还要在应用层实现自己的心跳功能呢？(keepalive)

- TCP心跳机制是传输层实现的，只要当前连接是可用的，对端就会ACK我们的心跳，而对于当前对端应用是否能正常提供服务，TCP层的心跳机制是无法获知的。我们在应用层实现的心跳功能是依赖于对端应用的，如果对端当前无法正常提供服务，通过应用层心跳功能马上就可以获知，我们可以进行相应的处理；
- tcp_keepalive_time参数的设置是秒级，对于极端情况，我们可能想在毫秒级就检测到连接的状态，这个TCP心跳机制就无法办到；
- 通用性，应用层心跳功能不依赖于传输层协议，如果有一天我们想将传输层协议由TCP改为UDP，那么传输层不提供心跳机制了，应用层的心跳是通用的，此时或许只用修改少量地方代码即可；
- 有些运营商会过滤掉keep包；

#### HTTP协议

##### http1.0、1.1、2.0 版本的主要区别？

- 1.0，连接不复用
- 1.1，连接复用，可以同时建立多个连接，每个连接能发送多个请求，但服务端需要按请求顺序返回，窜行处理。
- 2.0，头部压缩，二进制传输，同个连接可以不按顺序并行处理请求，服务端推送。

##### HTTP头Connection:keep-alive是什么意思？解决了什么问题？

- http1.1默认，告诉对方请求响应完成后不要关闭tcp连接，下次请求复用。解决了每次1.1前每次请求都建立tcp连接消耗资源的问题。

##### http状态码

- 200~299：成功状态码
- 300~399：重定向状态码
- 400~499：客户端错误状态码
- 500~599：服务端错误状态码

- 创建状态码：
  - 204：Not Content，响应报文中没有实体的主体部分。
  - 304：Not Modified，所请求的资源未修改，服务端不会返回任何资源。
  - 400：Bad Request，客户端请求语法错误，服务端无法理解。
  - 401：Unauthorized，需要鉴权。
  - **403**：Forbidden，无权限或者其它原因，请求被拒绝了。
  - 404：Not Found，服务器无法找到所请求的URL。
  - 500：Internal Server Error，服务器内部错误。
  - 502：Bad Gateway，被代理的服务器出现问题了，作为网关或者代理的服务器尝试执行请求时，从远程服务器接收到一个无效的响应。
  - **503**：Service Unavailabl，服务端宕机，用来说明服务器现在无法为该请求提供服务。
  - **504**：Gateway Timeout，网关错误，网关或代理的服务器，未及时从远端服务器获取请求。

##### tls工作原理？

![image-20221013152015961](.\img\image-20221013152015961.png)

  - 发送在三次握手后，3个报文协商密钥，传递公钥，传递公钥加密后的会话密钥，最会https建立成功，对称加密数据通信。
  - 第一个报文，客户端发送第一个随机数（本地也保存一份），还有客户端支持加密的套件。
  - 第二个报文，，服务端把第一个随机数保存，生成第二个随机数，发送给客户端，并告诉客户端选择的加密方案，还有服务端的ca证书（第三方机构签名，里面包含公钥）。
  - 客户端收到服务端的证书，先验证有没有问题，没问题保存第二个随机数，生成第三个随机数(也叫预主密钥)，用收到的服务端的公钥加密第三个随机数发送给服务端，服务端可以用私钥解密，此时这第三个随机数就只有客户端服务端知道，别人不知道，这是发送第三个时发生的。
  - 此时客户端，服务端都有，第一、第二、第三(预主密钥)个随机数，用第二次报文传递时服务端选择的加密套件对这三个随机数加密，得到会话密钥。正式传输数据就用这个会话密钥进行加密，
  - 随机数传递采用非对称加密，数据传输时采用对称加密。

#### DNS服务

- 域名系统，存储域名和IP地址互相映射的一个分布式数据库。

##### DNS工作原理？

![image-20221013152755177](.\img\image-20221013152755177.png)

- 两种查询方式，如图示。
- 先看看本地缓存有没有，没有本地域名服务器上级域名服务器请求。
- 比如www.baidu.com，先询问根域名服务器.com这个顶级域名服务器在哪，再访问.com顶级域名服务器询问baidu这个二级域名需要查询那个权威服务器，最后找到权威服务器询问www.baidu.com这个域名对应的ip。

##### DNS劫持

![image-20221013153746555](.\img\image-20221013153746555.png)

- 黑客攻击网络服务商，把DNS映射到错误的地址，比如游戏官网，赚取广告费
- 可以修改DNS服务地址，指定以阿里等大公司的DNS服务器作解析。

##### DNS欺骗

![image-20221013154033690](.\img\image-20221013154033690.png)

- 黑客冒充权威域名服务器，引导用户访问错误地址。

##### DDOS攻击

- DNS本质是一种程序，物理设备有容量承载极限，超过极限服务可能宕机
- 黑客针对某个域名进行大量请求，导致DNS服务器挂掉，或者目标服务器系统资源耗尽，服务中断，正常用户无法访问。

#### 网络IO